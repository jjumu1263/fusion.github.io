<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ChatGPT + Google 요약</title>
  <style>
    body { font-family: Arial; margin: 20px; display: flex; }
    #inputSection { width: 40%; }
    #resultSection { width: 55%; margin-left: 5%; }
    textarea { width: 100%; height: 100px; }
    #googleResults, #chatResult { margin-top: 10px; padding: 10px; border: 1px solid #ccc; white-space: pre-line; }
  </style>
</head>
<body>

<div id="inputSection">
  <h3>검색어 입력</h3>
  <textarea id="query"></textarea>
  <button id="searchBtn">검색 + 요약</button>
</div>

<div id="resultSection">
  <h3>Google 검색 결과</h3>
  <div id="googleResults">검색 결과가 여기에 표시됩니다.</div>
  <h3>ChatGPT 요약</h3>
  <div id="chatResult">요약 결과가 여기에 표시됩니다.</div>
</div>

<script>
  const searchBtn = document.getElementById("searchBtn");

  searchBtn.addEventListener("click", async () => {
    const query = document.getElementById("query").value;
    if (!query) return alert("검색어를 입력하세요.");

    document.getElementById("googleResults").innerText = "검색 중...";
    document.getElementById("chatResult").innerText = "요약 준비 중...";

    try {
      // 1️⃣ Google 검색 API 호출
      const googleRes = await fetch("/api/googleSearch", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ query })
      });
      const googleData = await googleRes.json();

      // 검색 결과 텍스트만 추출
      const items = googleData.items || [];
      const snippets = items.map(item => `${item.title}\n${item.snippet}\n${item.link}`).join("\n\n");
      document.getElementById("googleResults").innerText = snippets || "검색 결과가 없습니다.";

      // 2️⃣ ChatGPT API 호출 (요약)
      const chatRes = await fetch("/api/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt: `다음 검색 결과를 한국어로 정리해서 요약해줘:\n\n${snippets}` })
      });

      const chatData = await chatRes.json();
      if (chatData.choices?.length > 0) {
        document.getElementById("chatResult").innerText = chatData.choices[0].message.content;
      } else {
        document.getElementById("chatResult").innerText = "ChatGPT 요약이 없습니다.";
      }

    } catch (err) {
      document.getElementById("googleResults").innerText = "검색 에러: " + err;
      document.getElementById("chatResult").innerText = "ChatGPT 요약 에러: " + err;
    }
  });
</script>

</body>
</html>
